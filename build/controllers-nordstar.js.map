{"version":3,"sources":["controllers-nordstar.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","testCtrl","$scope","backend","$watch","angular","bind","this","orderInfo","newValue","newOrderInfoMeal","_","find","editable_extra_services","forEach","passengers","passenger","segments","segment","mealCount","reduce","selectedExtraServices","result","key","amount","twiceSelectedMeal","item","mealToRemove","modifyExtraService","passenger_id","id","segment_id","subgroup","service_type","serviceType","rfisc","directive","restrict","scope","controller","controllerAs","bindToController","2","./directives/mealLimitation"],"mappings":"CAAA,WAAY,QAASA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAE,kBAAmBC,UAASA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,GAAGF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAQ,IAAI,GAAIL,GAAE,kBAAmBD,UAASA,QAAQH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,GAAE,MAAOJ,OAAOiB,GAAG,SAAST,EAAQU,EAAOJ,GACxe,YAqBA,SAASK,GAASC,EAAQC,GAItBD,EAAOE,OAAOC,QAAQC,KAAKC,KAAM,WAC7B,MAAOA,MAAKC,YACZ,SAAUC,GACV,GAAIC,GAAmBC,EAAEC,KAAKH,EAASI,yBAA0BnB,KAAM,QAIlEgB,IAKLC,EAAEG,QAAQJ,EAAiBK,WAAY,SAAUC,GAC7CL,EAAEG,QAAQE,EAAUC,SAAU,SAAUC,GAIpC,GAAIC,GAAYR,EAAES,OAAOF,EAAQG,sBAAuB,SAAUC,EAAQC,GACtE,MAAOD,GAASC,EAAIC,QACrB,EAGH,IAAIL,EAAY,EAAG,CAGf,GAAIM,GAAoBd,EAAEC,KAAKM,EAAQG,sBAAuB,SAAUK,GACpE,MAAuB,KAAhBA,EAAKF,SAIZG,EAAeF,EAAoBA,EAAoBP,EAAQG,sBAAsB,EAEzFlB,GAAQyB,oBACJlC,KAAM,OACNmC,aAAcb,EAAUc,GACxBC,WAAYb,EAAQY,GACpBE,SAAU,OACVR,OAAQG,EAAaH,OAAS,EAC9BS,aAAcN,EAAaO,YAC3BC,MAAOR,EAAaQ,eA/D5C9B,QAAQL,OAAO,OAAOoC,UAAU,aAAc,WAC1C,OAEIC,SAAU,IAEVC,OACI9B,UAAW,KAGf+B,WAAY,WACZC,aAAc,KACdC,kBAAkB,MAM1BpC,QAAQL,OAAO,OAAOuC,WAAW,YAAa,SAAU,UAAWtC,SA0D7DyC,GAAG,SAASpD,EAAQU,EAAOJ,GACjC,YACAN,GAAQ,iCACLqD,8BAA8B,SAAS","file":"controllers-nordstar.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').directive('mealLimit', [function () {\n    return {\n\n        restrict: 'A',\n\n        scope: {\n            orderInfo: '='\n        },\n\n        controller: 'testCtrl',\n        controllerAs: 'vm',\n        bindToController: true\n\n    }\n}]);\n\n\nangular.module('app').controller('testCtrl', ['$scope', 'backend', testCtrl]);\n\n\nfunction testCtrl($scope, backend) {\n    var vm = this;\n\n    // https://stackoverflow.com/questions/24078535/angularjs-controller-as-syntax-and-watch\n    $scope.$watch(angular.bind(this, function () {\n        return this.orderInfo\n    }), function (newValue) {\n        var newOrderInfoMeal = _.find(newValue.editable_extra_services, {code: \"meal\"});\n\n\n        // Питание не выбрано\n        if (!newOrderInfoMeal) {\n            return;\n        }\n\n        // Питание выбрано\n        _.forEach(newOrderInfoMeal.passengers, function (passenger) {\n            _.forEach(passenger.segments, function (segment) {\n\n\n                // Подсчитать кол-во блюд для каждого пассажира\n                var mealCount = _.reduce(segment.selectedExtraServices, function (result, key) {\n                    return result + key.amount\n                }, 0);\n\n\n                if (mealCount > 2) {\n\n                    // найти блюдо, которое выбрано дважды.\n                    var twiceSelectedMeal = _.find(segment.selectedExtraServices, function (item) {\n                        return item.amount === 2\n                    });\n\n                    // Если такого блюда не найдено, удалить первое в массиве segment.selectedExtraServices\n                    var mealToRemove = twiceSelectedMeal ? twiceSelectedMeal : segment.selectedExtraServices[0];\n\n                    backend.modifyExtraService({\n                        code: 'meal',\n                        passenger_id: passenger.id,\n                        segment_id: segment.id,\n                        subgroup: 'cold',\n                        amount: mealToRemove.amount - 1,\n                        service_type: mealToRemove.serviceType,\n                        rfisc: mealToRemove.rfisc\n                    });\n                }\n            })\n        })\n    })\n}\n\n// function testCtrl() {\n//\n// }\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nrequire('./directives/mealLimitation');\n},{\"./directives/mealLimitation\":1}]},{},[2]);\n"]}